<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>angular-skeleton</title>

</head>

<body ng-app="myApp">

    <my-grouped-table-search-form></my-grouped-table-search-form>
    <my-grouped-table key="{{myGroupedTableSearchForm.serviceId}}"></my-grouped-table>

    












    <script src="./angular.js"></script>
    <script>
    angular.module("myApp", [])
        .factory("groupedTableService", [function() {
            var self;
            return self = {
                deepCopy: function(source) {
                    return angular.copy(source);
                },
                newInstance: function() {
                    return self.deepCopy({
                        head: ["结果为空"],
                        body: [{
                            groupName: "",
                            groupContent: []
                        }],
                        isEmpty: true
                    })
                },
                loadData: function(dataKey) {
                    if (dataKey == '1111')
                        return self.deepCopy({
                            head: ["col1", "col2", "col3"],
                            body: [{
                                groupName: "group1",
                                groupContent: [{
                                    col1: "group1-row1-col1",
                                    col2: "group1-row1-col2",
                                    col3: "group1-row1-col3"
                                }, {
                                    col1: "group1-row2-col1",
                                    col2: "group1-row2-col2",
                                    col3: "group1-row2-col3"
                                }]
                            }, {
                                groupName: "group2",
                                groupContent: [{
                                    col1: "group2-row1-col1",
                                    col2: "group2-row1-col2",
                                    col3: "group2-row1-col3"
                                }, {
                                    col1: "group2-row2-col1",
                                    col2: "group2-row2-col2",
                                    col3: "group2-row2-col3"
                                }]
                            }]
                        })
                    else if (dataKey == '2222')
                        return self.deepCopy({
                            head: ["col1", "col2", "col3"],
                            body: [{
                                groupName: "group4",
                                groupContent: [{
                                    col1: "group1-row1-col1",
                                    col2: "group1-row1-col2",
                                    col3: "group1-row1-col3"
                                }, {
                                    col1: "group1-row2-col1",
                                    col2: "group1-row2-col2",
                                    col3: "group1-row2-col3"
                                }]
                            }, {
                                groupName: "group5",
                                groupContent: [{
                                    col1: "group2-row1-col1",
                                    col2: "group2-row1-col2",
                                    col3: "group2-row1-col3"
                                }, {
                                    col1: "group2-row2-col1",
                                    col2: "group2-row2-col2",
                                    col3: "group2-row2-col3"
                                }]
                            }]
                        })
                    else{
                        return self.newInstance();
                    }
                }
            }
        }])
        .directive("myGroupedTable", [function() {
            return {
                restrict: "E",
                scope: {
                    key: '@'
                },
                templateUrl: './my-grouped-table-tpl.html',
                controller: ['groupedTableService', function(groupedTableService) {
                    var vm = this;
                    vm.reload = function(key) {
                        vm.data = groupedTableService.loadData(key);
                    }
                }],
                controllerAs: "myGroupedTable",
                require: 'myGroupedTable',
                link: function(scope, element, attr, myGroupedTableCtrl){
                    scope.$watch('key', function(newV, oldV) {
                        myGroupedTableCtrl.reload(newV);
                    })
                }
            }
        }])
        .directive("myGroupedTableSearchForm", [function() {
            return {
                restrict: "E",
                template: '<input ng-model="myGroupedTableSearchForm.input"/><button ng-click="myGroupedTableSearchForm.searchById(myGroupedTableSearchForm.input)">搜索服务单</button>',
                controller: ['$scope', function($scope) {
                    var vm = this;
                    vm.input = "";
                    vm.searchById = function(id) {
                        vm.serviceId = id;
                    }
                }],
                controllerAs: 'myGroupedTableSearchForm'
            }
        }])
    </script>
</body>

</html>
