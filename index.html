<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>angular-skeleton</title>

</head>

<body ng-app="myApp">
    <recent-search-page>
        <my-grouped-table-search-form></my-grouped-table-search-form>
        <my-grouped-table key="{{myGroupedTableSearchForm.serviceId}}"></my-grouped-table>
    </recent-search-page>


    <script src="./angular.js"></script>
    <script src="./angular-route.js"></script>
    <script src="./app.js"></script>
    <script>
    angular.module("myApp")
        .directive("myGroupedTable", [function() {
            return {
                restrict: "E",
                scope: {
                    key: '@'
                },
                templateUrl: './my-grouped-table-tpl.html',
                controller: ['dataFactory', function(dataFactory) {
                    var vm = this;
                    vm.reload = function(key) {
                        vm.data = dataFactory.loadData(key);
                    }
                }],
                controllerAs: "myGroupedTable",
                require: 'myGroupedTable',
                link: function(scope, element, attr, myGroupedTableCtrl){
                    scope.$watch('key', function(newV, oldV) {
                        myGroupedTableCtrl.reload(newV);
                    })
                }
            }
        }])
        .directive("myGroupedTableSearchForm", [function() {
            return {
                restrict: "E",
                template: '<input ng-model="myGroupedTableSearchForm.input"/><button ng-click="myGroupedTableSearchForm.searchById(myGroupedTableSearchForm.input)">搜索服务单</button>',
                controller: ['$scope', function($scope) {
                    var vm = this;
                    vm.input = "";
                    vm.searchById = function(id) {
                        vm.serviceId = id;
                    }
                }],
                controllerAs: 'myGroupedTableSearchForm'
            }
        }])
        .directive("recentSearchPage", [function(){
            return {
                restrict: "E",
                templateUrl: './recent-search-page-tpl.html',
                transclude: true
            }
        }])
    </script>
</body>

</html>
